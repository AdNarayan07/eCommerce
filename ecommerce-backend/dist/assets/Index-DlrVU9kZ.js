import{r as p,a as j,b as w,u as N,j as e,n as c,i as f,L as v,k,m as C,o as U}from"./index-dzztCWgy.js";import{a as S,b as A,r as $}from"./productsApi-_Aa8wOm2.js";import{N as q}from"./NoProductsAvailable-Bb3YDM4R.js";import{O as P}from"./Orders-Zc5QzDza.js";import{u as E}from"./useAuthRedirect-Z3h76svJ.js";import{N as O}from"./403-3w2D0IXK.js";import"./ordersApi-DN3KDto9.js";const T=()=>{const[t,r]=p.useState({name:"",price:"",quantity:"",image:null,shortDescription:"",detailedDescription:""}),[n,m]=p.useState({}),u=j(l=>l.auth.token),y=w(),b=N(),s=l=>{const{name:i,value:d}=l.target;r(h=>({...h,[i]:d}))},a=l=>{const i=l.target.files[0],d=new FileReader;d.onloadend=()=>{const g=d.result;r(D=>({...D,image:{data:g,name:i.name}}))};const h=5*1024*1024;i&&(i.size>h?(m(g=>({...g,image:"File size exceeds the limit of 5 MB."})),r(g=>({...g,image:null}))):d.readAsDataURL(i))},o=()=>{const{name:l,price:i,quantity:d}=t,h={};return l||(h.name="Product name is required."),i||(h.price="Price is required."),d||(h.quantity="Quantity is required."),m(h),h},x=async l=>{l.preventDefault();const i=o();if(!(Object.keys(i).length>0))try{c.start();const d=await S(t,u);r({name:"",price:"",quantity:"",image:null,shortDescription:"",detailedDescription:""}),alert("Product created with id: "+d.id)}catch(d){f(d,b,y)}finally{c.done()}};return e.jsxs("form",{onSubmit:x,className:"border p-4 rounded",children:[e.jsx("input",{type:"text",name:"name",placeholder:"Product Name",value:t.name,onChange:s,className:"border p-2 w-full"}),e.jsx("p",{className:"text-red-500 text-xs mb-1",children:n.name||"ㅤ"}),e.jsx("input",{type:"number",name:"price",placeholder:"Price",value:t.price,onChange:s,className:"border p-2 w-full"}),e.jsx("p",{className:"text-red-500 text-xs mb-1",children:n.price||"ㅤ"}),e.jsx("input",{type:"number",name:"quantity",placeholder:"Quantity",value:t.quantity,onChange:s,className:"border p-2 w-full"}),e.jsx("p",{className:"text-red-500 text-xs mb-1",children:n.quantity||"ㅤ"}),e.jsxs("div",{className:"mb-1 flex space-x-2",children:[e.jsx("label",{htmlFor:"image-upload",className:"p-2 block w-full cursor-pointer border focus:border-2 focus:border-black focus:rounded",tabIndex:0,children:e.jsx("span",{className:t.image?"":"opacity-50",children:t.image?t.image.name:"Choose product image (Max 5 MB)"})}),t.image&&e.jsx("button",{className:"border p-2 bg-gray-100 hover:bg-gray-200",onClick:()=>r(l=>({...l,image:null})),children:"Remove"}),e.jsx("input",{type:"file",name:"image",accept:"image/*",id:"image-upload",onChange:a,className:"hidden"})]}),e.jsx("p",{className:"text-red-500 text-xs",children:n.image||"ㅤ"}),e.jsx("input",{type:"text",name:"shortDescription",placeholder:"Short Description (Optional)",value:t.shortDescription,onChange:s,className:"border p-2 mb-1 w-full"}),e.jsx("textarea",{name:"detailedDescription",placeholder:"Detailed Description (Optional, in Markdown Format)",value:t.detailedDescription,onChange:s,className:"border p-2 mb-4 w-full",rows:"4"}),e.jsx("button",{type:"submit",className:"bg-blue-500 text-white px-4 py-2 rounded",children:"Add Product"})]})},F=()=>{var b;const t=j(s=>s.auth.user),r=j(s=>s.auth.token),[n,m]=p.useState(null),u=w();p.useEffect(()=>{(async()=>{try{c.start();const a=await A(r,t.username);console.log(a),m(a)}catch(a){f(a,u,N,!1)}finally{c.done()}})()},[]);const y=async(s,a)=>{s.stopPropagation();try{confirm(`Do you want to delete product ${a}?`)&&(c.start(),await $(a,r),m(x=>x.filter(l=>l.id!==a)),alert(`Product ${a} deleted`))}catch(o){f(o,u,N)}finally{c.done()}};return e.jsx("div",{className:"w-full h-full flex-grow",children:n?n.length?e.jsx("ul",{children:(b=n==null?void 0:n.map)==null?void 0:b.call(n,s=>e.jsxs("li",{onClick:()=>u(`/product/${s.id}`),className:"flex items-center justify-between space-x-4 p-4 rounded bg-gray-100 my-2 cursor-pointer",children:[e.jsxs("div",{className:"flex space-x-4",children:[e.jsxs("div",{className:"px-2 py-0.5 h-fit rounded bg-gray-300",children:["#",s.id]}),e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("div",{className:"font-bold",children:s.name}),e.jsx("div",{className:"text-sm",children:s.shortDescription})]})]}),e.jsx("button",{className:"bg-red-600 px-2 py-0.5 rounded text-white",onClick:a=>y(a,s.id),children:"Delete"})]},s.id))}):e.jsx(q,{}):e.jsx(v,{component:"Products"})})},R=()=>{const[t,r]=p.useState("addProduct"),n=()=>{switch(t){case"addProduct":return e.jsx(T,{});case"products":return e.jsx(F,{});case"orders":return e.jsx(P,{by:"seller"});default:return null}};return e.jsxs("div",{className:"p-4 flex flex-col items-center h-full",children:[e.jsx("h1",{className:"text-2xl font-bold mb-4 w-full",children:"Seller Dashboard"}),e.jsxs("div",{className:"mb-4 flex space-x-4 w-full",children:[e.jsx("button",{onClick:()=>r("addProduct"),className:`px-4 py-2 border rounded ${t==="addProduct"?"bg-blue-500 text-white":"bg-gray-200"}`,children:"Add Product"}),e.jsx("button",{onClick:()=>r("products"),className:`px-4 py-2 border rounded ${t==="products"?"bg-blue-500 text-white":"bg-gray-200"}`,children:"My Products"}),e.jsx("button",{onClick:()=>r("orders"),className:`px-4 py-2 border rounded ${t==="orders"?"bg-blue-500 text-white":"bg-gray-200"}`,children:"My Orders"})]}),n()]})},M=()=>{const[t,r]=p.useState(null),n=j(s=>s.auth.token),m=w(),u=N();p.useEffect(()=>{(async()=>{try{c.start();const o=(await k(n)).sort((x,l)=>x.username.localeCompare(l.username));r(o)}catch(a){f(a,m,u)}finally{c.done()}})()},[]);const y=async(s,a)=>{try{c.start();const o=await C(s,n,{role:a});r(x=>x.map(l=>l.username===s?{...l,role:o.role}:l)),alert(`User ${s}'s role updated to ${a}`)}catch(o){f(o,m,u)}finally{c.done()}},b=async s=>{if(confirm(`Are you sure you want to delete user ${s}?`))try{c.start(),await U(s,n),r(o=>o.filter(x=>x.username!==s)),alert(`User ${s} deleted successfully.`)}catch(o){f(o,m,u)}finally{c.done()}};return t?t.length?e.jsxs("div",{className:"users",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Manage Users"})," ",e.jsxs("div",{className:"w-fit bg-white p-6 rounded shadow-md",children:[" ",e.jsxs("table",{className:"min-w-full bg-gray-100 rounded my-2",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-300 text-gray-800 text-left",children:[e.jsx("th",{className:"py-2 px-4",children:"Username"}),e.jsx("th",{className:"py-2 px-4",children:"Phone"}),e.jsx("th",{className:"py-2 px-4",children:"Email"}),e.jsx("th",{className:"py-2 px-4",children:"Role"}),e.jsx("th",{className:"py-2 px-4",children:"Actions"})]})}),e.jsx("tbody",{children:t.map(s=>e.jsxs("tr",{className:"border-b",children:[e.jsx("td",{className:"py-2 px-4",children:s.username}),e.jsx("td",{className:"py-2 px-4",children:s.phone}),e.jsx("td",{className:"py-2 px-4",children:s.email}),e.jsx("td",{className:"py-2 px-4",children:e.jsxs("select",{value:s.role,onChange:a=>y(s.username,a.target.value),className:"border p-1 rounded disabled:cursor-not-allowed",disabled:s.username==="@root",title:s.username==="@root"?"Cannot Edit @root User":"",children:[e.jsx("option",{value:"admin",children:"Admin"}),e.jsx("option",{value:"seller",children:"Seller"}),e.jsx("option",{value:"shopper",children:"Shopper"})]})}),e.jsx("td",{className:"py-2 px-4",children:e.jsx("button",{className:"bg-red-500 text-white px-4 py-1 rounded disabled:opacity-50 disabled:cursor-not-allowed",onClick:()=>b(s.username),disabled:s.username==="@root",title:s.username==="@root"?"Cannot Delete @root User":"",children:"Delete"})})]},s.username))})]})]})]}):e.jsxs("div",{className:"flex flex-col items-center justify-center h-full w-full bg-gray-100 font-semibold text-4xl p-10",children:[e.jsx("p",{className:"text-8xl",children:":("}),e.jsx("p",{className:"mt-8",children:"No Users"})]}):e.jsx(v,{component:"User"})},z=()=>{const[t,r]=p.useState("Users");return e.jsxs("div",{className:"p-4 flex flex-col items-center h-full",children:[e.jsx("h1",{className:"text-2xl font-bold mb-4 w-full",children:"Admin Dashboard"})," ",e.jsxs("div",{className:"mb-4 flex space-x-4 w-full",children:[e.jsx("button",{className:`px-4 py-2 border rounded ${t==="Users"?"bg-blue-500 text-white":"bg-gray-200"}`,onClick:()=>r("Users"),children:"Users"}),e.jsx("button",{className:`px-4 py-2 border rounded ${t==="Orders"?"bg-blue-500 text-white":"bg-gray-200"}`,onClick:()=>r("Orders"),children:"Orders"})]}),t==="Users"&&e.jsx(M,{})," ",t==="Orders"&&e.jsx(P,{by:"admin"})," "]})},K=()=>{const t=j(r=>r.auth.user);return E(!1,"/login"),c.done(),e.jsxs(e.Fragment,{children:[(t==null?void 0:t.role)==="admin"&&e.jsx(z,{})," ",(t==null?void 0:t.role)==="seller"&&e.jsx(R,{})," ",(t==null?void 0:t.role)==="shopper"&&e.jsx(O,{})," "]})};export{K as default};
