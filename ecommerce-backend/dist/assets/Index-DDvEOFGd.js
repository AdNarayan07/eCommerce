import{r as p,a as f,b as j,u as y,j as e,L as w,n as m,i as P,k as D,m as k}from"./index-CgZGQlFR.js";import{a as C,b as U,r as A}from"./productsApi-CqAmWrJA.js";import{h as b}from"./functions-DhrN1Fze.js";import{N as S}from"./NoProductsAvailable-BSU8MVu8.js";import{O as N}from"./Orders-0-jPhSV4.js";import{u as $}from"./useAuthRedirect-DaxOBDOI.js";import{N as O}from"./403-sQ6kfsVB.js";import"./ordersApi-XeE1hMh7.js";const q=()=>{const[t,n]=p.useState({name:"",price:"",quantity:"",image:null,shortDescription:"",detailedDescription:""}),c=f(a=>a.auth.token),h=j(),d=y(),i=a=>{const{name:l,value:o}=a.target;n(u=>({...u,[l]:o}))},x=a=>{const l=a.target.files[0],o=new FileReader;o.onloadend=()=>{const g=o.result;n(v=>({...v,image:{data:g,name:l.name}}))};const u=5*1024*1024;l&&(l.size>u?(alert(`File size exceeds the limit of ${u/(1024*1024)} MB`),n(g=>({...g,image:null}))):o.readAsDataURL(l))},s=()=>{const{name:a,price:l,quantity:o}=t,u={};return a||(u.name="Product name is required."),l||(u.price="Price is required."),o||(u.quantity="Quantity is required."),u},r=async a=>{a.preventDefault();const l=s();if(Object.keys(l).length>0){alert(Object.values(l).join(" "));return}try{const o=await C(t,c);n({name:"",price:"",quantity:"",image:null,shortDescription:"",detailedDescription:""}),alert("Product created with id: "+o.id)}catch(o){b(o,d,h)}};return e.jsxs("form",{onSubmit:r,className:"border p-4 rounded",children:[e.jsx("input",{type:"text",name:"name",placeholder:"Product Name",value:t.name,onChange:i,className:"border p-2 mb-2 w-full"}),e.jsx("input",{type:"number",name:"price",placeholder:"Price",value:t.price,onChange:i,className:"border p-2 mb-2 w-full"}),e.jsx("input",{type:"number",name:"quantity",placeholder:"Quantity",value:t.quantity,onChange:i,className:"border p-2 mb-2 w-full"}),e.jsxs("div",{className:"mb-2 flex space-x-2",children:[e.jsx("label",{htmlFor:"image-upload",className:"p-2 block w-full cursor-pointer border focus:border-2 focus:border-black focus:rounded",tabIndex:0,children:e.jsx("span",{className:t.image?"":"opacity-50",children:t.image?t.image.name:"Choose product image (Max 5 MB)"})}),t.image&&e.jsx("button",{className:"border p-2 bg-gray-100 hover:bg-gray-200",onClick:()=>n(a=>({...a,image:null})),children:"Remove"}),e.jsx("input",{type:"file",name:"image",accept:"image/*",id:"image-upload",onChange:x,className:"hidden"})]}),e.jsx("input",{type:"text",name:"shortDescription",placeholder:"Short Description (Optional)",value:t.shortDescription,onChange:i,className:"border p-2 mb-2 w-full"}),e.jsx("textarea",{name:"detailedDescription",placeholder:"Detailed Description (Optional, in Markdown Format)",value:t.detailedDescription,onChange:i,className:"border p-2 mb-4 w-full",rows:"4"}),e.jsx("button",{type:"submit",className:"bg-blue-500 text-white px-4 py-2 rounded",children:"Add Product"})]})},T=()=>{var x;const t=f(s=>s.auth.user),n=f(s=>s.auth.token),[c,h]=p.useState(null),d=j();p.useEffect(()=>{(async()=>{try{m.start();const r=await U(n,t.username);console.log(r),h(r)}catch(r){b(r,d,y,!1)}finally{m.done()}})()},[]);const i=async(s,r)=>{s.stopPropagation();try{confirm(`Do you want to delete product ${r}?`)&&(await A(r,n),h(l=>l.filter(o=>o.id!==r)),alert(`Product ${r} deleted`))}catch(a){b(a,d,y)}};return e.jsx("div",{className:"w-full h-full flex-grow",children:c?c.length?e.jsx("ul",{children:(x=c==null?void 0:c.map)==null?void 0:x.call(c,s=>e.jsxs("li",{onClick:()=>d(`/product/${s.id}`),className:"flex items-center justify-between space-x-4 p-4 rounded bg-gray-100 my-2 cursor-pointer",children:[e.jsxs("div",{className:"flex space-x-4",children:[e.jsxs("div",{className:"px-2 py-0.5 h-fit rounded bg-gray-300",children:["#",s.id]}),e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("div",{className:"font-bold",children:s.name}),e.jsx("div",{className:"text-sm",children:s.shortDescription})]})]}),e.jsx("button",{className:"bg-red-600 px-2 py-0.5 rounded text-white",onClick:r=>i(r,s.id),children:"Delete"})]},s.id))}):e.jsx(S,{}):e.jsx(w,{component:"Products"})})},F=()=>{const[t,n]=p.useState("addProduct"),c=()=>{switch(t){case"addProduct":return e.jsx(q,{});case"products":return e.jsx(T,{});case"orders":return e.jsx(N,{by:"seller"});default:return null}};return e.jsxs("div",{className:"p-4 flex flex-col items-center h-full",children:[e.jsx("h1",{className:"text-2xl font-bold mb-4 w-full",children:"Seller Dashboard"}),e.jsxs("div",{className:"mb-4 flex space-x-4 w-full",children:[e.jsx("button",{onClick:()=>n("addProduct"),className:`px-4 py-2 border rounded ${t==="addProduct"?"bg-blue-500 text-white":"bg-gray-200"}`,children:"Add Product"}),e.jsx("button",{onClick:()=>n("products"),className:`px-4 py-2 border rounded ${t==="products"?"bg-blue-500 text-white":"bg-gray-200"}`,children:"My Products"}),e.jsx("button",{onClick:()=>n("orders"),className:`px-4 py-2 border rounded ${t==="orders"?"bg-blue-500 text-white":"bg-gray-200"}`,children:"My Orders"})]}),c()]})},R=()=>{const[t,n]=p.useState([]),c=f(s=>s.auth.token),h=j(),d=y();p.useEffect(()=>{(async()=>{try{m.start();const a=(await P(c)).sort((l,o)=>l.username.localeCompare(o.username));n(a)}catch(r){b(r,h,d)}finally{m.done()}})()},[]);const i=async(s,r)=>{try{m.start();const a=await D(s,c,{role:r});n(l=>l.map(o=>o.username===s?{...o,role:a.role}:o)),alert(`User ${s}'s role updated to ${r}`)}catch(a){b(a,h,d)}finally{m.done()}},x=async s=>{if(confirm(`Are you sure you want to delete user ${s}?`))try{m.start(),await k(s,c),n(a=>a.filter(l=>l.username!==s)),alert(`User ${s} deleted successfully.`)}catch(a){b(a,h,d)}finally{m.done()}};return e.jsxs("div",{className:"users",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Manage Users"}),e.jsx("div",{className:"w-fit bg-white p-6 rounded shadow-md",children:e.jsxs("table",{className:"min-w-full bg-gray-100 rounded my-2",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-300 text-gray-800 text-left",children:[e.jsx("th",{className:"py-2 px-4",children:"Username"}),e.jsx("th",{className:"py-2 px-4",children:"Phone"}),e.jsx("th",{className:"py-2 px-4",children:"Email"}),e.jsx("th",{className:"py-2 px-4",children:"Role"}),e.jsx("th",{className:"py-2 px-4",children:"Actions"})]})}),e.jsx("tbody",{children:t.map(s=>e.jsxs("tr",{className:"border-b",children:[e.jsx("td",{className:"py-2 px-4",children:s.username}),e.jsx("td",{className:"py-2 px-4",children:s.phone}),e.jsx("td",{className:"py-2 px-4",children:s.email}),e.jsx("td",{className:"py-2 px-4",children:e.jsxs("select",{value:s.role,onChange:r=>i(s.username,r.target.value),className:"border p-1 rounded",disabled:s.username==="@root",children:[e.jsx("option",{value:"admin",children:"Admin"}),e.jsx("option",{value:"seller",children:"Seller"}),e.jsx("option",{value:"shopper",children:"Shopper"})]})}),e.jsx("td",{className:"py-2 px-4",children:e.jsx("button",{className:"bg-red-500 text-white px-4 py-1 rounded disabled:opacity-50",onClick:()=>x(s.username),disabled:s.username==="@root",children:"Delete"})})]},s.username))})]})})]})},M=()=>{const[t,n]=p.useState("Users");return e.jsxs("div",{className:"p-4 flex flex-col items-center h-full",children:[e.jsx("h1",{className:"text-2xl font-bold mb-4 w-full",children:"Admin Dashboard"}),e.jsxs("div",{className:"mb-4 flex space-x-4 w-full",children:[e.jsx("button",{className:`px-4 py-2 border rounded ${t==="Users"?"bg-blue-500 text-white":"bg-gray-200"}`,onClick:()=>n("Users"),children:"Users"}),e.jsx("button",{className:`px-4 py-2 border rounded ${t==="Orders"?"bg-blue-500 text-white":"bg-gray-200"}`,onClick:()=>n("Orders"),children:"Orders"})]}),e.jsxs("div",{className:"tab-content mt-4",children:[t==="Users"&&e.jsx(R,{}),t==="Orders"&&e.jsx(N,{by:"admin"})]})]})},J=()=>{const t=f(n=>n.auth.user);return $(!1,"/login"),m.done(),e.jsxs(e.Fragment,{children:[(t==null?void 0:t.role)==="admin"&&e.jsx(M,{}),(t==null?void 0:t.role)==="seller"&&e.jsx(F,{}),(t==null?void 0:t.role)==="shopper"&&e.jsx(O,{})]})};export{J as default};
