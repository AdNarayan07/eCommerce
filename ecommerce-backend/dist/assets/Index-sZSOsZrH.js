import{r as x,a as f,b as j,u as y,j as e,n as d,L as N,i as P,k as D,m as k}from"./index-Ej1216eK.js";import{a as C,b as U,r as A}from"./productsApi-pId0hLHq.js";import{h as b}from"./functions-CJRTszaY.js";import{N as S}from"./NoProductsAvailable-BGu4d861.js";import{O as w}from"./Orders-CTSCVo0l.js";import{u as $}from"./useAuthRedirect-BAMBD_te.js";import{N as O}from"./403-jd8ukmjN.js";import"./ordersApi-qJxpp2nt.js";const q=()=>{const[t,l]=x.useState({name:"",price:"",quantity:"",image:null,shortDescription:"",detailedDescription:""}),c=f(a=>a.auth.token),h=j(),i=y(),u=a=>{const{name:n,value:o}=a.target;l(m=>({...m,[n]:o}))},p=a=>{const n=a.target.files[0],o=new FileReader;o.onloadend=()=>{const g=o.result;l(v=>({...v,image:{data:g,name:n.name}}))};const m=5*1024*1024;n&&(n.size>m?(alert(`File size exceeds the limit of ${m/(1024*1024)} MB`),l(g=>({...g,image:null}))):o.readAsDataURL(n))},s=()=>{const{name:a,price:n,quantity:o}=t,m={};return a||(m.name="Product name is required."),n||(m.price="Price is required."),o||(m.quantity="Quantity is required."),m},r=async a=>{a.preventDefault();const n=s();if(Object.keys(n).length>0){alert(Object.values(n).join(" "));return}try{d.start();const o=await C(t,c);l({name:"",price:"",quantity:"",image:null,shortDescription:"",detailedDescription:""}),alert("Product created with id: "+o.id)}catch(o){b(o,i,h)}finally{d.done()}};return e.jsxs("form",{onSubmit:r,className:"border p-4 rounded",children:[e.jsx("input",{type:"text",name:"name",placeholder:"Product Name",value:t.name,onChange:u,className:"border p-2 mb-2 w-full"}),e.jsx("input",{type:"number",name:"price",placeholder:"Price",value:t.price,onChange:u,className:"border p-2 mb-2 w-full"}),e.jsx("input",{type:"number",name:"quantity",placeholder:"Quantity",value:t.quantity,onChange:u,className:"border p-2 mb-2 w-full"}),e.jsxs("div",{className:"mb-2 flex space-x-2",children:[e.jsx("label",{htmlFor:"image-upload",className:"p-2 block w-full cursor-pointer border focus:border-2 focus:border-black focus:rounded",tabIndex:0,children:e.jsx("span",{className:t.image?"":"opacity-50",children:t.image?t.image.name:"Choose product image (Max 5 MB)"})}),t.image&&e.jsx("button",{className:"border p-2 bg-gray-100 hover:bg-gray-200",onClick:()=>l(a=>({...a,image:null})),children:"Remove"}),e.jsx("input",{type:"file",name:"image",accept:"image/*",id:"image-upload",onChange:p,className:"hidden"})]}),e.jsx("input",{type:"text",name:"shortDescription",placeholder:"Short Description (Optional)",value:t.shortDescription,onChange:u,className:"border p-2 mb-2 w-full"}),e.jsx("textarea",{name:"detailedDescription",placeholder:"Detailed Description (Optional, in Markdown Format)",value:t.detailedDescription,onChange:u,className:"border p-2 mb-4 w-full",rows:"4"}),e.jsx("button",{type:"submit",className:"bg-blue-500 text-white px-4 py-2 rounded",children:"Add Product"})]})},T=()=>{var p;const t=f(s=>s.auth.user),l=f(s=>s.auth.token),[c,h]=x.useState(null),i=j();x.useEffect(()=>{(async()=>{try{d.start();const r=await U(l,t.username);console.log(r),h(r)}catch(r){b(r,i,y,!1)}finally{d.done()}})()},[]);const u=async(s,r)=>{s.stopPropagation();try{confirm(`Do you want to delete product ${r}?`)&&(d.start(),await A(r,l),h(n=>n.filter(o=>o.id!==r)),alert(`Product ${r} deleted`))}catch(a){b(a,i,y)}finally{d.done()}};return e.jsx("div",{className:"w-full h-full flex-grow",children:c?c.length?e.jsx("ul",{children:(p=c==null?void 0:c.map)==null?void 0:p.call(c,s=>e.jsxs("li",{onClick:()=>i(`/product/${s.id}`),className:"flex items-center justify-between space-x-4 p-4 rounded bg-gray-100 my-2 cursor-pointer",children:[e.jsxs("div",{className:"flex space-x-4",children:[e.jsxs("div",{className:"px-2 py-0.5 h-fit rounded bg-gray-300",children:["#",s.id]}),e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("div",{className:"font-bold",children:s.name}),e.jsx("div",{className:"text-sm",children:s.shortDescription})]})]}),e.jsx("button",{className:"bg-red-600 px-2 py-0.5 rounded text-white",onClick:r=>u(r,s.id),children:"Delete"})]},s.id))}):e.jsx(S,{}):e.jsx(N,{component:"Products"})})},F=()=>{const[t,l]=x.useState("addProduct"),c=()=>{switch(t){case"addProduct":return e.jsx(q,{});case"products":return e.jsx(T,{});case"orders":return e.jsx(w,{by:"seller"});default:return null}};return e.jsxs("div",{className:"p-4 flex flex-col items-center h-full",children:[e.jsx("h1",{className:"text-2xl font-bold mb-4 w-full",children:"Seller Dashboard"}),e.jsxs("div",{className:"mb-4 flex space-x-4 w-full",children:[e.jsx("button",{onClick:()=>l("addProduct"),className:`px-4 py-2 border rounded ${t==="addProduct"?"bg-blue-500 text-white":"bg-gray-200"}`,children:"Add Product"}),e.jsx("button",{onClick:()=>l("products"),className:`px-4 py-2 border rounded ${t==="products"?"bg-blue-500 text-white":"bg-gray-200"}`,children:"My Products"}),e.jsx("button",{onClick:()=>l("orders"),className:`px-4 py-2 border rounded ${t==="orders"?"bg-blue-500 text-white":"bg-gray-200"}`,children:"My Orders"})]}),c()]})},R=()=>{const[t,l]=x.useState(null),c=f(s=>s.auth.token),h=j(),i=y();x.useEffect(()=>{(async()=>{try{d.start();const a=(await P(c)).sort((n,o)=>n.username.localeCompare(o.username));l(a)}catch(r){b(r,h,i)}finally{d.done()}})()},[]);const u=async(s,r)=>{try{d.start();const a=await D(s,c,{role:r});l(n=>n.map(o=>o.username===s?{...o,role:a.role}:o)),alert(`User ${s}'s role updated to ${r}`)}catch(a){b(a,h,i)}finally{d.done()}},p=async s=>{if(confirm(`Are you sure you want to delete user ${s}?`))try{d.start(),await k(s,c),l(a=>a.filter(n=>n.username!==s)),alert(`User ${s} deleted successfully.`)}catch(a){b(a,h,i)}finally{d.done()}};return t?t.length?e.jsxs("div",{className:"users",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Manage Users"}),e.jsx("div",{className:"w-fit bg-white p-6 rounded shadow-md",children:e.jsxs("table",{className:"min-w-full bg-gray-100 rounded my-2",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-300 text-gray-800 text-left",children:[e.jsx("th",{className:"py-2 px-4",children:"Username"}),e.jsx("th",{className:"py-2 px-4",children:"Phone"}),e.jsx("th",{className:"py-2 px-4",children:"Email"}),e.jsx("th",{className:"py-2 px-4",children:"Role"}),e.jsx("th",{className:"py-2 px-4",children:"Actions"})]})}),e.jsx("tbody",{children:t.map(s=>e.jsxs("tr",{className:"border-b",children:[e.jsx("td",{className:"py-2 px-4",children:s.username}),e.jsx("td",{className:"py-2 px-4",children:s.phone}),e.jsx("td",{className:"py-2 px-4",children:s.email}),e.jsx("td",{className:"py-2 px-4",children:e.jsxs("select",{value:s.role,onChange:r=>u(s.username,r.target.value),className:"border p-1 rounded disabled:cursor-not-allowed",disabled:s.username==="@root",title:s.username==="@root"?"Cannot Edit @root User":"",children:[e.jsx("option",{value:"admin",children:"Admin"}),e.jsx("option",{value:"seller",children:"Seller"}),e.jsx("option",{value:"shopper",children:"Shopper"})]})}),e.jsx("td",{className:"py-2 px-4",children:e.jsx("button",{className:"bg-red-500 text-white px-4 py-1 rounded disabled:opacity-50 disabled:cursor-not-allowed",onClick:()=>p(s.username),disabled:s.username==="@root",title:s.username==="@root"?"Cannot Delete @root User":"",children:"Delete"})})]},s.username))})]})})]}):e.jsxs("div",{className:"flex flex-col items-center justify-center h-full w-full bg-gray-100 font-semibold text-4xl p-10",children:[e.jsx("p",{className:"text-8xl",children:":("}),e.jsx("p",{className:"mt-8",children:"No Users"})]}):e.jsx(N,{component:"User"})},E=()=>{const[t,l]=x.useState("Users");return e.jsxs("div",{className:"p-4 flex flex-col items-center h-full",children:[e.jsx("h1",{className:"text-2xl font-bold mb-4 w-full",children:"Admin Dashboard"}),e.jsxs("div",{className:"mb-4 flex space-x-4 w-full",children:[e.jsx("button",{className:`px-4 py-2 border rounded ${t==="Users"?"bg-blue-500 text-white":"bg-gray-200"}`,onClick:()=>l("Users"),children:"Users"}),e.jsx("button",{className:`px-4 py-2 border rounded ${t==="Orders"?"bg-blue-500 text-white":"bg-gray-200"}`,onClick:()=>l("Orders"),children:"Orders"})]}),t==="Users"&&e.jsx(R,{}),t==="Orders"&&e.jsx(w,{by:"admin"})]})},J=()=>{const t=f(l=>l.auth.user);return $(!1,"/login"),d.done(),e.jsxs(e.Fragment,{children:[(t==null?void 0:t.role)==="admin"&&e.jsx(E,{}),(t==null?void 0:t.role)==="seller"&&e.jsx(F,{}),(t==null?void 0:t.role)==="shopper"&&e.jsx(O,{})]})};export{J as default};
