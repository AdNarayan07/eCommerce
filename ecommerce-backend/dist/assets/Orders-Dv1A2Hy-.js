import{a as O,r as h,b as C,u as w,j as t,L as k,n as b}from"./index-CSu__qN_.js";import{f as D,a as P,b as $,c as L,u as E}from"./ordersApi-DpmA27Ju.js";import{c as p,h as u}from"./functions-B1vvauzJ.js";const I=({by:c})=>{var y;const n=O(e=>e.auth.token),[l,i]=h.useState(null),[o,f]=h.useState({}),d=C(),x=w(),N=e=>c==="seller"?e!=="Placed":e==="Delivered"||e.startsWith("Cancelled");h.useEffect(()=>{(async()=>{try{b.start();let s;switch(c){case"seller":s=$;break;case"shopper":s=P;break;default:s=D}const a=await s(n);i(a)}catch(s){u(s,d,x,!1)}finally{b.done()}})()},[]);function m(e){const s=new Date(e).toLocaleString("en-IN",{dateStyle:"medium"}),a=new Date(e).toLocaleString("en-IN",{timeStyle:"short"});return t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"font-bold text-blue-950",children:s}),t.jsx("div",{className:"text-xs font-semibold",children:a})]})}const g=async e=>{try{if(confirm("Do you want to cancel the order?")){const a=await L(e,n);i(r=>r.map(j=>j.id===e?a:j)),alert(`Order ${e} cancelled`)}}catch(s){u(s,d,x)}},S=async e=>{try{const s=await E(e,n,{status:o[e]});i(a=>a.map(r=>r.id===e?s:r)),alert(`Order ${e} status updated to ${o[e]}`)}catch(s){u(s,d,x)}},v=(e,s)=>{f(a=>({...a,[e]:s}))};return l?l.length?t.jsx("div",{className:"w-fit bg-white p-6 rounded shadow-md",children:t.jsxs("table",{className:"min-w-full bg-gray-100 rounded my-2",children:[t.jsx("thead",{children:t.jsxs("tr",{className:"bg-gray-300 text-gray-800 text-left",children:[t.jsx("th",{className:"py-2 px-4",children:"Order ID"}),t.jsx("th",{className:"py-2 px-4",children:"Product"}),t.jsx("th",{className:"py-2 px-4 text-center",children:"Status"}),t.jsx("th",{className:"py-2 px-4 text-right",children:"Order Placed"}),t.jsx("th",{className:"py-2 px-4 text-right",children:"Last Update"}),t.jsx("th",{className:"py-2 px-4 text-center",children:c==="admin"?"Update Status":"Cancel Order"})]})}),t.jsx("tbody",{children:(y=l==null?void 0:l.map)==null?void 0:y.call(l,e=>{var s,a;return t.jsxs("tr",{className:"border-b",children:[t.jsxs("td",{className:"py-2 px-4 cursor-pointer hover:underline",onClick:()=>d(`/order/${e.id}`),children:["#",e.id]}),t.jsx("td",{className:"py-2 px-4 font-bold text-red-950 cursor-pointer hover:underline",onClick:()=>{var r;return d(`/product/${(r=e.Product)==null?void 0:r.id}`)},children:t.jsxs("div",{className:"flex items-center",children:[t.jsxs("span",{className:"px-2 py-0.5 rounded bg-red-100 text-xs mr-2",children:["#",((s=e.Product)==null?void 0:s.id)||0]}),((a=e.Product)==null?void 0:a.name)||"Deleted Product"]})}),t.jsx("td",{className:"py-2 px-4 text-center",children:t.jsx("span",{className:`px-2 py-0.5 rounded bg-${p(e.status)}-50 text-sm border border-${p(e.status)}-950 text-${p(e.status)}-950 font-semibold`,children:e.status})}),t.jsx("td",{className:"py-2 px-4 text-right",children:m(e.createdAt)}),t.jsx("td",{className:"py-2 px-4 text-right",children:m(e.updatedAt)}),c!=="admin"?t.jsx("td",{className:"py-2 px-4 text-center",children:t.jsx("button",{className:"bg-red-600 px-2 py-0.5 rounded text-white disabled:cursor-not-allowed disabled:opacity-50",onClick:()=>g(e.id),disabled:N(e.status),children:"Cancel"})}):t.jsxs("td",{className:"py-2 px-4 text-center",children:[t.jsxs("select",{value:o[e.id]||e.status,onChange:r=>v(e.id,r.target.value),className:"bg-gray-100 px-2 py-0.5 rounded border border-gray-300",disabled:e.status.startsWith("Cancelled"),children:[t.jsx("option",{value:"Placed",children:"Placed"}),t.jsx("option",{value:"Shipped",children:"Shipped"}),t.jsx("option",{value:"Out for Delivery",children:"Out for Delivery"}),t.jsx("option",{value:"Delivered",children:"Delivered"}),e.status.startsWith("Cancelled")&&t.jsxs(t.Fragment,{children:[t.jsx("option",{value:"Cancelled by Seller",children:"Cancelled by Seller"}),t.jsx("option",{value:"Cancelled by Shopper",children:"Cancelled by Shopper"})]})]}),t.jsx("button",{className:"ml-2 bg-blue-600 px-2 py-0.5 rounded text-white",onClick:()=>S(e.id),children:"Update"})]})]},e.id)})})]})}):t.jsxs("div",{className:"flex flex-col items-center justify-center h-full w-full bg-gray-100 font-semibold text-4xl p-10",children:[t.jsx("p",{className:"text-8xl",children:":("}),t.jsx("p",{className:"mt-8",children:"No Orders"})]}):t.jsx(k,{component:"Orders"})};export{I as O};
