import{a as y,r as c,u as v,b as C,j as e,c as b,o as F,e as k,p as T,n as U,q,d as O}from"./index-Ej1216eK.js";import{F as $,v as z}from"./FormFields-DV6ItUOQ.js";import{h as D}from"./functions-CJRTszaY.js";import{u as R}from"./useAuthRedirect-BAMBD_te.js";import{O as M}from"./Orders-CTSCVo0l.js";import"./ordersApi-qJxpp2nt.js";const I=({onClose:a})=>{const{username:h}=y(t=>t.auth.user),g=y(t=>t.auth.token),[s,x]=c.useState({currentPassword:"",newPassword:"",confirmPassword:""}),[d,o]=c.useState({}),i=v(),u=C(),r=t=>{x({...s,[t.target.name]:t.target.value}),o({...d,[t.target.name]:""})},p=()=>{const t={},m=/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[!"#$%&'()*+,\-./:;<=>?@[\\\]^_`{|}~])[A-Za-z\d!"#$%&'()*+,\-./:;<=>?@[\\\]^_`{|}~]{8,}$/;return s.currentPassword||(t.currentPassword="Current Password is required."),s.newPassword?m.test(s.newPassword)?s.newPassword===s.currentPassword&&(t.newPassword="New password can't be same as current password."):t.newPassword="New Password must be at least 8 characters long, contain an uppercase letter, a lowercase letter, a number, and a special character.":t.newPassword="New Password is required.",s.confirmPassword?s.newPassword!==s.confirmPassword&&(t.confirmPassword="New Passwords do not match."):t.confirmPassword="Please confirm your new password.",t},P=async t=>{var m,f;try{t.preventDefault();const n=p();if(Object.keys(n).length>0){o(n);return}i(b(!0));const N=await F(g,{...s,username:h});u("/login"),alert(N.message),i(k()),a()}catch(n){n.status===498&&(alert("Token Expired or Invalid, Login Again!"),u("/login")),console.error(n),alert(((f=(m=n.response)==null?void 0:m.data)==null?void 0:f.message)||n.message||n),a()}finally{i(b(!1))}};return e.jsx("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 flex justify-center items-center z-50",children:e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-lg w-full max-w-md",children:[e.jsx("h2",{className:"text-xl mb-4",children:"Change Password"}),e.jsxs("form",{onSubmit:P,children:[e.jsxs("div",{children:[e.jsx("label",{className:"block",children:"Current Password"}),e.jsx("input",{type:"password",name:"currentPassword",value:s.currentPassword,onChange:r,className:"border p-2 mt-2 w-full"}),e.jsx("p",{className:"text-red-500 text-xs mb-2",children:d.currentPassword||"ㅤ"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block",children:"New Password"}),e.jsx("input",{type:"password",name:"newPassword",value:s.newPassword,onChange:r,className:"border p-2 mt-2 w-full"}),e.jsx("p",{className:"text-red-500 text-xs mb-2",children:d.newPassword||"ㅤ"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block",children:"Confirm New Password"}),e.jsx("input",{type:"password",name:"confirmPassword",value:s.confirmPassword,onChange:r,className:"border p-2 mt-2 w-full"}),e.jsx("p",{className:"text-red-500 text-xs mb-2",children:d.confirmPassword||"ㅤ"})]}),e.jsxs("div",{className:"flex justify-end space-x-4 mt-4",children:[e.jsx("button",{type:"button",className:"bg-gray-300 text-black px-4 py-2 rounded",onClick:a,children:"Cancel"}),e.jsx("button",{type:"submit",className:"bg-blue-500 text-white px-4 py-2 rounded",children:"Change Password"})]})]})]})})},Z=({onClose:a})=>{const[h,g]=c.useState(""),[s,x]=c.useState(""),d=C(),o=v(),i=y(r=>r.auth.token),u=async r=>{r.preventDefault();try{o(b(!0)),await T(i,{username:h,password:s}),alert("Account deleted successfully!"),o(k()),d("/login")}catch(p){D(p,d,o)}finally{o(b(!1))}};return e.jsx("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 flex justify-center items-center z-50",children:e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-lg w-full max-w-md",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Delete Account"}),e.jsxs("form",{onSubmit:u,children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-gray-700 mb-2",children:"Username"}),e.jsx("input",{type:"text",name:"username",value:h,onChange:r=>g(r.target.value),className:"w-full px-4 py-2 border rounded",required:!0})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-gray-700 mb-2",children:"Password"}),e.jsx("input",{type:"password",name:"password",value:s,onChange:r=>x(r.target.value),className:"w-full px-4 py-2 border rounded",required:!0})]}),e.jsxs("div",{className:"flex justify-end space-x-4",children:[e.jsx("button",{type:"button",className:"bg-gray-300 px-4 py-2 rounded",onClick:a,children:"Cancel"}),e.jsx("button",{type:"submit",className:"bg-red-500 text-white px-4 py-2 rounded",children:"Delete Account"})]})]})]})})},K=()=>{const a=y(l=>l.auth.user),h=y(l=>l.auth.token),g=C(),[s,x]=c.useState(a),[d,o]=c.useState({}),[i,u]=c.useState(!1),[r,p]=c.useState(!1),[P,t]=c.useState(!1),[m,f]=c.useState("account"),n=v();R(!1,"/login");const N=l=>{x({...s,[l.target.name]:l.target.value}),o({...d,[l.target.name]:""})},S=l=>{var w,j;l.preventDefault(),(j=(w=document.getElementsByTagName("input"))==null?void 0:w.displayname)==null||j.focus(),u(!0)},E=async l=>{l.preventDefault();try{const w=z(s,!1);if(Object.keys(w).length>0){o(w);return}n(b(!0));const j=await q(h,s);alert("Profile edited successfully!"),n(O(j)),u(!1)}catch(w){D(w,g,n),x(a)}finally{n(b(!1))}},A=()=>{x(a),u(!1),o({})};return U.done(),a&&e.jsxs("div",{className:"flex flex-col items-center h-full w-full p-4",children:[e.jsxs("div",{className:"mb-4 flex space-x-4 w-full",children:[e.jsx("button",{className:`px-4 py-2 border rounded ${m==="account"?"bg-blue-500 text-white":"bg-gray-200"}`,onClick:()=>f("account"),children:"My Account"}),e.jsx("button",{className:`px-4 py-2 border rounded ${m==="orders"?"bg-blue-500 text-white":"bg-gray-200"}`,onClick:()=>f("orders"),children:"My Orders"})]}),m==="account"?e.jsxs("form",{className:"bg-white p-6 rounded shadow-md w-full max-w-3xl",onSubmit:E,children:[e.jsx($,{form:s,errors:d,handleChange:N,isEditable:i,isRegistrationForm:!1}),e.jsx("div",{className:"flex space-x-4",children:i?e.jsxs(e.Fragment,{children:[e.jsx("button",{type:"submit",className:"bg-green-500 text-white px-4 py-2 rounded",children:"Save"}),e.jsx("button",{type:"reset",className:"bg-red-500 text-white px-4 py-2 rounded",onClick:A,children:"Revert"})]}):e.jsxs(e.Fragment,{children:[e.jsx("button",{type:"button",className:"bg-blue-500 text-white px-4 py-2 rounded disabled:opacity-50 disabled:cursor-not-allowed",onClick:S,disabled:a.username==="@root",title:a.username==="@root"?"Cannot Edit @root User":"",children:"Edit"}),e.jsx("button",{type:"button",className:"bg-red-500 text-white px-4 py-2 rounded disabled:opacity-50 disabled:cursor-not-allowed",onClick:()=>p(!0),disabled:a.username==="@root",title:a.username==="@root"?"Cannot Edit @root User":"",children:"Change Password"}),e.jsx("button",{type:"button",className:"bg-red-700 text-white px-4 py-2 rounded disabled:opacity-50 disabled:cursor-not-allowed",onClick:()=>t(!0),disabled:a.username==="@root",title:a.username==="@root"?"Cannot Delete @root User":"",children:"Delete Account"})]})})]}):e.jsx(M,{by:"shopper"}),r&&e.jsx(I,{onClose:()=>p(!1)}),P&&e.jsx(Z,{onClose:()=>t(!1)})]})};export{K as default};
