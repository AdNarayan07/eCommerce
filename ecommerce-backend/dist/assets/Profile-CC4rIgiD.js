import{a as j,r as d,u as v,b as C,j as e,c as g,p as F,e as k,q as T,i as D,n as U,t as q,d as O}from"./index-dzztCWgy.js";import{F as $,v as z}from"./FormFields-Rj60OLoA.js";import{u as R}from"./useAuthRedirect-Z3h76svJ.js";import{O as M}from"./Orders-Zc5QzDza.js";import"./ordersApi-DN3KDto9.js";const I=({onClose:a})=>{const{username:p}=j(t=>t.auth.user),f=j(t=>t.auth.token),[s,x]=d.useState({currentPassword:"",newPassword:"",confirmPassword:""}),[l,n]=d.useState({}),i=v(),u=C(),r=t=>{x({...s,[t.target.name]:t.target.value}),n({...l,[t.target.name]:""})},b=()=>{const t={},m=/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[!"#$%&'()*+,\-./:;<=>?@[\\\]^_`{|}~])[A-Za-z\d!"#$%&'()*+,\-./:;<=>?@[\\\]^_`{|}~]{8,}$/;return s.currentPassword||(t.currentPassword="Current Password is required."),s.newPassword?m.test(s.newPassword)?s.newPassword===s.currentPassword&&(t.newPassword="New password can't be the same as current password."):t.newPassword="New Password must be at least 8 characters long, contain an uppercase letter, a lowercase letter, a number, and a special character.":t.newPassword="New Password is required.",s.confirmPassword?s.newPassword!==s.confirmPassword&&(t.confirmPassword="New passwords do not match."):t.confirmPassword="Please confirm your new password.",t},N=async t=>{var y,w;t.preventDefault();const m=b();if(Object.keys(m).length>0){n(m);return}try{i(g(!0));const c=await F(f,{...s,username:p});alert(c.message),i(k()),u("/login"),a()}catch(c){c.status===498&&(alert("Token Expired or Invalid, Login Again!"),u("/login")),console.error(c),alert(((w=(y=c.response)==null?void 0:y.data)==null?void 0:w.message)||c.message||c),a()}finally{i(g(!1))}};return e.jsx("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 flex justify-center items-center z-50",children:e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-lg w-full max-w-md",children:[e.jsx("h2",{className:"text-xl mb-4",children:"Change Password"}),e.jsxs("form",{onSubmit:N,children:[e.jsxs("div",{children:[e.jsx("label",{className:"block",children:"Current Password"}),e.jsx("input",{type:"password",name:"currentPassword",value:s.currentPassword,onChange:r,className:"border p-2 mt-2 w-full"}),e.jsx("p",{className:"text-red-500 text-xs mb-2",children:l.currentPassword||"ㅤ"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block",children:"New Password"}),e.jsx("input",{type:"password",name:"newPassword",value:s.newPassword,onChange:r,className:"border p-2 mt-2 w-full"}),e.jsx("p",{className:"text-red-500 text-xs mb-2",children:l.newPassword||"ㅤ"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block",children:"Confirm New Password"}),e.jsx("input",{type:"password",name:"confirmPassword",value:s.confirmPassword,onChange:r,className:"border p-2 mt-2 w-full"}),e.jsx("p",{className:"text-red-500 text-xs mb-2",children:l.confirmPassword||"ㅤ"})]}),e.jsxs("div",{className:"flex justify-end space-x-4 mt-4",children:[e.jsx("button",{type:"button",className:"bg-gray-300 text-black px-4 py-2 rounded",onClick:a,children:"Cancel"}),e.jsx("button",{type:"submit",className:"bg-blue-500 text-white px-4 py-2 rounded",children:"Change Password"})]})]})]})})},Z=({onClose:a})=>{const[p,f]=d.useState(""),[s,x]=d.useState(""),l=C(),n=v(),i=j(r=>r.auth.token),u=async r=>{r.preventDefault();try{n(g(!0)),await T(i,{username:p,password:s}),alert("Account deleted successfully!"),n(k()),l("/login")}catch(b){D(b,l,n)}finally{n(g(!1))}};return e.jsx("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 flex justify-center items-center z-50",children:e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-lg w-full max-w-md",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Delete Account"}),e.jsxs("form",{onSubmit:u,children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-gray-700 mb-2",children:"Username"}),e.jsx("input",{type:"text",name:"username",value:p,onChange:r=>f(r.target.value),className:"w-full px-4 py-2 border rounded",required:!0})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-gray-700 mb-2",children:"Password"}),e.jsx("input",{type:"password",name:"password",value:s,onChange:r=>x(r.target.value),className:"w-full px-4 py-2 border rounded",required:!0})]}),e.jsxs("div",{className:"flex justify-end space-x-4",children:[e.jsx("button",{type:"button",className:"bg-gray-300 px-4 py-2 rounded",onClick:a,children:"Cancel"}),e.jsx("button",{type:"submit",className:"bg-red-500 text-white px-4 py-2 rounded",children:"Delete Account"})]})]})]})})},J=()=>{const a=j(o=>o.auth.user),p=j(o=>o.auth.token),f=C(),[s,x]=d.useState(a),[l,n]=d.useState({}),[i,u]=d.useState(!1),[r,b]=d.useState(!1),[N,t]=d.useState(!1),[m,y]=d.useState("account"),w=v();R(!1,"/login");const c=o=>{x({...s,[o.target.name]:o.target.value}),n({...l,[o.target.name]:""})},S=o=>{var h,P;o.preventDefault(),(P=(h=document.getElementsByTagName("input"))==null?void 0:h.displayname)==null||P.focus(),u(!0)},E=async o=>{o.preventDefault();try{const h=z(s,!1);if(Object.keys(h).length>0){n(h);return}w(g(!0));const P=await q(p,s);alert("Profile edited successfully!"),w(O(P)),u(!1)}catch(h){D(h,f,w),x(a)}finally{w(g(!1))}},A=()=>{x(a),u(!1),n({})};return U.done(),a&&e.jsxs("div",{className:"flex flex-col items-center h-full w-full p-4",children:[e.jsxs("div",{className:"mb-4 flex space-x-4 w-full",children:[e.jsx("button",{className:`px-4 py-2 border rounded ${m==="account"?"bg-blue-500 text-white":"bg-gray-200"}`,onClick:()=>y("account"),children:"My Account"}),e.jsx("button",{className:`px-4 py-2 border rounded ${m==="orders"?"bg-blue-500 text-white":"bg-gray-200"}`,onClick:()=>y("orders"),children:"My Orders"})]}),m==="account"?e.jsxs("form",{className:"bg-white p-6 rounded shadow-md w-full max-w-3xl",onSubmit:E,children:[e.jsx($,{form:s,errors:l,handleChange:c,isEditable:i,isRegistrationForm:!1}),e.jsx("div",{className:"flex space-x-4",children:i?e.jsxs(e.Fragment,{children:[e.jsx("button",{type:"submit",className:"bg-green-500 text-white px-4 py-2 rounded",children:"Save"}),e.jsx("button",{type:"reset",className:"bg-red-500 text-white px-4 py-2 rounded",onClick:A,children:"Revert"})]}):e.jsxs(e.Fragment,{children:[e.jsx("button",{type:"button",className:"bg-blue-500 text-white px-4 py-2 rounded disabled:opacity-50 disabled:cursor-not-allowed",onClick:S,disabled:a.username==="@root",title:a.username==="@root"?"Cannot Edit @root User":"",children:"Edit"}),e.jsx("button",{type:"button",className:"bg-red-500 text-white px-4 py-2 rounded disabled:opacity-50 disabled:cursor-not-allowed",onClick:()=>b(!0),disabled:a.username==="@root",title:a.username==="@root"?"Cannot Edit @root User":"",children:"Change Password"}),e.jsx("button",{type:"button",className:"bg-red-700 text-white px-4 py-2 rounded disabled:opacity-50 disabled:cursor-not-allowed",onClick:()=>t(!0),disabled:a.username==="@root",title:a.username==="@root"?"Cannot Delete @root User":"",children:"Delete Account"})]})})]}):e.jsx(M,{by:"shopper"}),r&&e.jsx(I,{onClose:()=>b(!1)}),N&&e.jsx(Z,{onClose:()=>t(!1)})]})};export{J as default};
