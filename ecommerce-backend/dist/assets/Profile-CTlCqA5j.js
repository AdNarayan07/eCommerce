import{a as y,r as d,u as v,b as C,j as e,c as b,o as F,e as k,p as T,n as q,q as O,d as $}from"./index-CgZGQlFR.js";import{F as z,v as R}from"./FormFields-DTCDatxa.js";import{h as S}from"./functions-DhrN1Fze.js";import{u as M}from"./useAuthRedirect-DaxOBDOI.js";import{O as U}from"./Orders-0-jPhSV4.js";import"./ordersApi-XeE1hMh7.js";const I=({onClose:n})=>{const{username:h}=y(t=>t.auth.user),g=y(t=>t.auth.token),[s,x]=d.useState({currentPassword:"",newPassword:"",confirmPassword:""}),[c,o]=d.useState({}),i=v(),u=C(),a=t=>{x({...s,[t.target.name]:t.target.value}),o({...c,[t.target.name]:""})},p=()=>{const t={},m=/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]{8,}$/;return s.currentPassword||(t.currentPassword="Current Password is required."),s.newPassword?m.test(s.newPassword)?s.newPassword===s.currentPassword&&(t.newPassword="New password can't be same as current password."):t.newPassword="New Password must be at least 8 characters long, contain an uppercase letter, a lowercase letter, a number, and a special character.":t.newPassword="New Password is required.",s.confirmPassword?s.newPassword!==s.confirmPassword&&(t.confirmPassword="New Passwords do not match."):t.confirmPassword="Please confirm your new password.",t},P=async t=>{var m,f;try{t.preventDefault();const r=p();if(Object.keys(r).length>0){o(r);return}i(b(!0));const N=await F(g,{...s,username:h});u("/login"),alert(N.message),i(k()),n()}catch(r){r.status===498&&(alert("Token Expired or Invalid, Login Again!"),u("/login")),console.error(r),alert(((f=(m=r.response)==null?void 0:m.data)==null?void 0:f.message)||r.message||r),n()}finally{i(b(!1))}};return e.jsx("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 flex justify-center items-center z-50",children:e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-lg w-full max-w-md",children:[e.jsx("h2",{className:"text-xl mb-4",children:"Change Password"}),e.jsxs("form",{onSubmit:P,children:[e.jsxs("div",{children:[e.jsx("label",{className:"block",children:"Current Password"}),e.jsx("input",{type:"password",name:"currentPassword",value:s.currentPassword,onChange:a,className:"border p-2 mt-2 w-full"}),e.jsx("p",{className:"text-red-500 text-xs mb-2",children:c.currentPassword||"ㅤ"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block",children:"New Password"}),e.jsx("input",{type:"password",name:"newPassword",value:s.newPassword,onChange:a,className:"border p-2 mt-2 w-full"}),e.jsx("p",{className:"text-red-500 text-xs mb-2",children:c.newPassword||"ㅤ"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block",children:"Confirm New Password"}),e.jsx("input",{type:"password",name:"confirmPassword",value:s.confirmPassword,onChange:a,className:"border p-2 mt-2 w-full"}),e.jsx("p",{className:"text-red-500 text-xs mb-2",children:c.confirmPassword||"ㅤ"})]}),e.jsxs("div",{className:"flex justify-end space-x-4 mt-4",children:[e.jsx("button",{type:"button",className:"bg-gray-300 text-black px-4 py-2 rounded",onClick:n,children:"Cancel"}),e.jsx("button",{type:"submit",className:"bg-blue-500 text-white px-4 py-2 rounded",children:"Change Password"})]})]})]})})},Z=({onClose:n})=>{const[h,g]=d.useState(""),[s,x]=d.useState(""),c=C(),o=v(),i=y(a=>a.auth.token),u=async a=>{a.preventDefault();try{o(b(!0)),await T(i,{username:h,password:s}),alert("Account deleted successfully!"),o(k()),c("/login")}catch(p){S(p,c,o)}finally{o(b(!1))}};return e.jsx("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 flex justify-center items-center z-50",children:e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-lg w-full max-w-md",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Delete Account"}),e.jsxs("form",{onSubmit:u,children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-gray-700 mb-2",children:"Username"}),e.jsx("input",{type:"text",name:"username",value:h,onChange:a=>g(a.target.value),className:"w-full px-4 py-2 border rounded",required:!0})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-gray-700 mb-2",children:"Password"}),e.jsx("input",{type:"password",name:"password",value:s,onChange:a=>x(a.target.value),className:"w-full px-4 py-2 border rounded",required:!0})]}),e.jsxs("div",{className:"flex justify-end space-x-4",children:[e.jsx("button",{type:"button",className:"bg-gray-300 px-4 py-2 rounded",onClick:n,children:"Cancel"}),e.jsx("button",{type:"submit",className:"bg-red-500 text-white px-4 py-2 rounded",children:"Delete Account"})]})]})]})})},Q=()=>{const n=y(l=>l.auth.user),h=y(l=>l.auth.token),g=C(),[s,x]=d.useState(n),[c,o]=d.useState({}),[i,u]=d.useState(!1),[a,p]=d.useState(!1),[P,t]=d.useState(!1),[m,f]=d.useState("account"),r=v();M(!1,"/login");const N=l=>{x({...s,[l.target.name]:l.target.value}),o({...c,[l.target.name]:""})},D=l=>{var w,j;l.preventDefault(),(j=(w=document.getElementsByTagName("input"))==null?void 0:w.displayname)==null||j.focus(),u(!0)},E=async l=>{l.preventDefault();try{const w=R(s,!1);if(Object.keys(w).length>0){o(w);return}r(b(!0));const j=await O(h,s);alert("Profile edited successfully!"),r($(j)),u(!1)}catch(w){S(w,g,r),x(n)}finally{r(b(!1))}},A=()=>{x(n),u(!1),o({})};return q.done(),n&&e.jsxs("div",{className:"flex flex-col items-center h-full w-full p-4",children:[e.jsxs("div",{className:"mb-4 flex space-x-4 w-full",children:[e.jsx("button",{className:`px-4 py-2 border rounded ${m==="account"?"bg-blue-500 text-white":"bg-gray-200"}`,onClick:()=>f("account"),children:"My Account"}),e.jsx("button",{className:`px-4 py-2 border rounded ${m==="orders"?"bg-blue-500 text-white":"bg-gray-200"}`,onClick:()=>f("orders"),children:"My Orders"})]}),m==="account"?e.jsxs("form",{className:"bg-white p-6 rounded shadow-md w-full max-w-3xl",onSubmit:E,children:[e.jsx(z,{form:s,errors:c,handleChange:N,isEditable:i,isRegistrationForm:!1}),e.jsx("div",{className:"flex space-x-4",children:i?e.jsxs(e.Fragment,{children:[e.jsx("button",{type:"submit",className:"bg-green-500 text-white px-4 py-2 rounded",children:"Save"}),e.jsx("button",{type:"reset",className:"bg-red-500 text-white px-4 py-2 rounded",onClick:A,children:"Revert"})]}):e.jsxs(e.Fragment,{children:[e.jsx("button",{type:"button",className:"bg-blue-500 text-white px-4 py-2 rounded",onClick:D,disabled:n.username==="@root",children:"Edit"}),e.jsx("button",{type:"button",className:"bg-red-500 text-white px-4 py-2 rounded",onClick:()=>p(!0),children:"Change Password"}),e.jsx("button",{type:"button",className:"bg-red-700 text-white px-4 py-2 rounded",onClick:()=>t(!0),children:"Delete Account"})]})})]}):e.jsx(U,{by:"shopper"}),a&&e.jsx(I,{onClose:()=>p(!1)}),P&&e.jsx(Z,{onClose:()=>t(!1)})]})};export{Q as default};
