import{a as O,r as p,b as w,u as C,j as t,L as k,n as d}from"./index-Ej1216eK.js";import{f as D,a as P,b as $,c as L,u as E}from"./ordersApi-qJxpp2nt.js";import{c as u,h as m}from"./functions-CJRTszaY.js";const F=({by:n})=>{var j;const i=O(e=>e.auth.token),[l,o]=p.useState(null),[x,f]=p.useState({}),c=w(),h=C(),N=e=>n==="seller"?e!=="Placed":e==="Delivered"||e.startsWith("Cancelled");p.useEffect(()=>{(async()=>{try{d.start();let s;switch(n){case"seller":s=$;break;case"shopper":s=P;break;default:s=D}const a=await s(i);o(a)}catch(s){m(s,c,h,!1)}finally{d.done()}})()},[]);function y(e){const s=new Date(e).toLocaleString("en-IN",{dateStyle:"medium"}),a=new Date(e).toLocaleString("en-IN",{timeStyle:"short"});return t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"font-bold text-blue-950",children:s}),t.jsx("div",{className:"text-xs font-semibold",children:a})]})}const g=async e=>{try{if(confirm("Do you want to cancel the order?")){d.start();const a=await L(e,i);o(r=>r.map(b=>b.id===e?a:b)),alert(`Order ${e} cancelled`)}}catch(s){m(s,c,h)}finally{d.done()}},S=async e=>{try{d.start();const s=await E(e,i,{status:x[e]});o(a=>a.map(r=>r.id===e?s:r)),alert(`Order ${e} status updated to ${x[e]}`)}catch(s){m(s,c,h)}finally{d.done()}},v=(e,s)=>{f(a=>({...a,[e]:s}))};return l?l.length?t.jsx("div",{className:"w-fit bg-white p-6 rounded shadow-md",children:t.jsxs("table",{className:"min-w-full bg-gray-100 rounded my-2",children:[t.jsx("thead",{children:t.jsxs("tr",{className:"bg-gray-300 text-gray-800 text-left",children:[t.jsx("th",{className:"py-2 px-4",children:"Order ID"}),t.jsx("th",{className:"py-2 px-4",children:"Product"}),t.jsx("th",{className:"py-2 px-4 text-center",children:"Status"}),t.jsx("th",{className:"py-2 px-4 text-right",children:"Order Placed"}),t.jsx("th",{className:"py-2 px-4 text-right",children:"Last Update"}),t.jsx("th",{className:"py-2 px-4 text-center",children:n==="admin"?"Update Status":"Cancel Order"})]})}),t.jsx("tbody",{children:(j=l==null?void 0:l.map)==null?void 0:j.call(l,e=>{var s,a;return t.jsxs("tr",{className:"border-b",children:[t.jsxs("td",{className:"py-2 px-4 cursor-pointer hover:underline",onClick:()=>c(`/order/${e.id}`),children:["#",e.id]}),t.jsx("td",{className:"py-2 px-4 font-bold text-red-950 cursor-pointer hover:underline",onClick:()=>{var r;return c(`/product/${(r=e.Product)==null?void 0:r.id}`)},children:t.jsxs("div",{className:"flex items-center",children:[t.jsxs("span",{className:"px-2 py-0.5 rounded bg-red-100 text-xs mr-2",children:["#",((s=e.Product)==null?void 0:s.id)||0]}),((a=e.Product)==null?void 0:a.name)||"Deleted Product"]})}),t.jsx("td",{className:"py-2 px-4 text-center",children:t.jsx("span",{className:`px-2 py-0.5 rounded bg-${u(e.status)}-50 text-sm border border-${u(e.status)}-950 text-${u(e.status)}-950 font-semibold`,children:e.status})}),t.jsx("td",{className:"py-2 px-4 text-right",children:y(e.createdAt)}),t.jsx("td",{className:"py-2 px-4 text-right",children:y(e.updatedAt)}),n!=="admin"?t.jsx("td",{className:"py-2 px-4 text-center",children:t.jsx("button",{className:"bg-red-600 px-2 py-0.5 rounded text-white disabled:cursor-not-allowed disabled:opacity-50",onClick:()=>g(e.id),disabled:N(e.status),children:"Cancel"})}):t.jsxs("td",{className:"py-2 px-4 flex justify-between",children:[t.jsxs("select",{value:x[e.id]||e.status,onChange:r=>v(e.id,r.target.value),className:"bg-gray-100 px-2 py-0.5 rounded border border-gray-300 disabled:cursor-not-allowed",disabled:e.status.startsWith("Cancelled"),children:[t.jsx("option",{value:"Placed",children:"Placed"}),t.jsx("option",{value:"Shipped",children:"Shipped"}),t.jsx("option",{value:"Out for Delivery",children:"Out for Delivery"}),t.jsx("option",{value:"Delivered",children:"Delivered"}),e.status.startsWith("Cancelled")&&t.jsxs(t.Fragment,{children:[t.jsx("option",{value:"Cancelled by Seller",children:"Cancelled by Seller"}),t.jsx("option",{value:"Cancelled by Shopper",children:"Cancelled by Shopper"})]})]}),t.jsx("button",{className:"ml-2 bg-blue-600 px-2 py-0.5 rounded text-white disabled:opacity-50 disabled:cursor-not-allowed",onClick:()=>S(e.id),disabled:e.status.startsWith("Cancelled"),children:"Update"})]})]},e.id)})})]})}):t.jsxs("div",{className:"flex flex-col items-center justify-center h-full w-full bg-gray-100 font-semibold text-4xl p-10",children:[t.jsx("p",{className:"text-8xl",children:":("}),t.jsx("p",{className:"mt-8",children:"No Orders"})]}):t.jsx(k,{component:"Orders"})};export{F as O};
